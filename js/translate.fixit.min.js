(()=>{var g=!0,c=!1,h=[],u=[],d=[],m=[],f=["https://www.haoyep.com","https://cdn.haoyep.com"],L=["english","chinese_traditional"],p="translate.service",y=[];var w=["fi-at-ignore","header-title","language-switch","post-author","powered","author","typeit","katex","katex-display","message-content"],b=["repo-url","repo-visibility","repo-lang","netease-music","comment-163"],I=['[data-adapters="projects"] .single-subtitle'],E=["Hugo","FixIt","hugo-fixit","Lruihao","shortcode","CC BY-NC-SA","RSS"];var{hugoLangCodes:T,hugoLangMap:v,fromLanguages:x,onlyLocalLang:C,nomenclature:S}=window.ATConfig,o=class{constructor(){this.service=p,this.languages=L,this.ignoreClass=[...w,...b,...h],this.ignoreID=u,this.ignoreTag=m,this.ignoreSelector=[...I,...d],this.ignoreText=[...E,...f],this.detectLocalLanguage=g,this.enterprise=c,this.isMobile=fixit.util.isMobile(),this.afterExecuteEvents=new Set,this.lang={...this.getTypesLang()},this.supportLanguages={"client.edge":translate.service.edge.language.json,"translate.service":y},this.hugoLangCodes=T,this.hugoLangMap=v,this.fromLanguages=x||[],this.onlyLocalLang=C,this.nomenclature=S,this.dom={}}getLangNameById(e){return this.supportLanguages[this.service]?.find(t=>t.id===e)?.name}getLangCodeById(e){return Object.keys(translate.util.browserLanguage).find(t=>translate.util.browserLanguage[t]===e)}getLangIdByCode(e){return translate.util.browserLanguage[e]}getTypesLang(){return{current:translate.language.getCurrent(),local:window.ATConfig.local||translate.language.getLocal(),query:window.location.search.split("lang=")[1],browser:this.lang?.browser||""}}toggleVisibility(e,t){e.classList.toggle("d-none",!t),e.setAttribute("aria-hidden",!t)}toggleMenuActive(e){Array.from(this.dom.switchMenu.childNodes).filter(t=>t.classList.contains("active")).forEach(t=>{t.classList.remove("active")}),e.classList.add("active")}handleDesktop(){if(this.dom.switchDesktop=document.querySelector("#header-desktop .language-switch.auto"),!this.dom.switchDesktop)return;this.dom.switchMenu=this.dom.switchDesktop.querySelector(".sub-menu"),this.dom.localItems&&this.dom.switchMenu.append(...this.dom.localItems),this.#e(),this.#t();let e=this.dom.switchDesktop.previousElementSibling;e.classList.contains("language-switch")&&this.toggleVisibility(e,!1),this.toggleVisibility(this.dom.switchDesktop,!0),this.afterExecuteEvents.add(()=>{this.lang={...this.getTypesLang()};let{current:t,local:a,query:s}=this.getTypesLang();this.lang={...this.lang,current:t,query:s},(t!==a||s)&&this.toggleMenuActive(document.querySelector(`.menu-link[data-lang="${t}"]`).parentElement)})}#e(){let e=Array.from(this.dom.switchMenu.childNodes).filter(t=>t.dataset.type==="artificial");fixit.util.forEach(e,t=>{if(t.classList.contains("active")&&!t.children[0].getAttribute("title")){let a=this.getLangNameById(this.lang.local);t.children[0].setAttribute("title",a),t.children[0].insertAdjacentText("beforeend",a)}t.addEventListener("click",a=>{translate.language.clearCacheLanguage()})})}#t(){let e=Array.from(this.dom.switchMenu.childNodes).filter(t=>t.dataset.type==="machine");fixit.util.forEach(e,t=>{let a=t.children[0].dataset.lang,s=this.getLangNameById(a),i=this.getLangCodeById(a);if(this.service==="client.edge"&&!s){this.toggleVisibility(t,!1);return}if(this.hugoLangCodes.includes(i)||a==this.lang.local){this.toggleVisibility(t,!1);return}t.addEventListener("click",l=>{window.history.pushState({},"",`?lang=${a}`),this.toggleMenuActive(t),translate.changeLanguage(a)})})}handleMobile(){this.dom.switchMobile=document.querySelector("#header-mobile .language-switch.auto"),this.dom.switchMobile&&(this.#a(),this.afterExecuteEvents.add(()=>{new Promise(e=>{let t=setInterval(()=>{this.dom.selectEl=this.dom.switchMobile.querySelector("select"),this.dom.selectEl&&(clearInterval(t),e())},100)}).then(()=>{this.dom.selectEl.classList.add("language-select"),this.#s(),this.#i();let{current:e,local:t,query:a}=this.getTypesLang();this.lang={...this.lang,current:e,query:a},(e!==t||a)&&(this.dom.selectEl.value=e),this.toggleVisibility(this.dom.switchMobile,!0)})}))}#a(){translate.selectLanguageTag.selectOnChange=e=>{let t=e.target.value;e.target.options[e.target.selectedIndex].dataset.type==="artificial"?(translate.language.clearCacheLanguage(),window.location=t):(window.history.pushState({},"",`?lang=${t}`),translate.changeLanguage(t))}}#s(){fixit.util.forEach(this.dom.selectEl.querySelectorAll("option"),e=>{e.dataset.type="machine",e.innerText=`\u{1F916} ${e.innerText}`;let t=this.getLangCodeById(e.value);(this.hugoLangCodes.includes(t)||e.value==this.lang.local)&&e.parentElement.removeChild(e)})}#i(){let e=this.dom.switchMobile.previousElementSibling;if(this.hugoLangCodes.length>1){fixit.util.forEach(e.querySelectorAll("option"),i=>{if(!i.getAttribute("value"))return i.parentElement.removeChild(i);i.dataset.type="artificial",i.innerText=`\u{1F464} ${i.innerText}`,i.disabled&&i.removeAttribute("disabled")}),this.dom.selectEl.prepend(...e.querySelectorAll("option:not([selected])")),this.dom.selectEl.prepend(e.querySelector("option[selected]")),this.toggleVisibility(e,!1);return}let t=this.dom.switchMobile.querySelector('[role="button"]'),a=this.getLangNameById(this.lang.local);t.dataset.current||(t.dataset.current=a,t.insertAdjacentText("afterbegin",a));let s=document.createElement("option");s.selected=!0,s.dataset.type="artificial",s.value=window.location.pathname,s.innerText=`\u{1F464} ${a}`,this.dom.selectEl.prepend(s),this.toggleVisibility(e,!1)}handle(){return this.isMobile?this.handleMobile():this.handleDesktop(),this}setup(){return this.enterprise?translate.enterprise.use():translate.service.use(this.service),document.querySelectorAll(this.ignoreSelector.join(",")).forEach(e=>{e.classList.add("fi-at-ignore")}),this.nomenclature?.forEach(e=>{translate.nomenclature.append(e.from,e.to,Object.keys(e.properties).map(t=>`${t}=${e.properties[t]}`).join(`
`))}),this.onlyLocalLang&&(this.fromLanguages=[this.lang.local]),translate.language.translateLanguagesRange=this.fromLanguages,translate.ignore.id.push(...this.ignoreID),translate.ignore.class.push(...this.ignoreClass),translate.ignore.tag.push(...this.ignoreTag),translate.ignore.text.push(...this.ignoreText),translate.language.setLocal(this.lang.local),translate.language.setUrlParamControl("lang"),translate.listener.start(),translate.selectLanguageTag.show=this.isMobile,translate.selectLanguageTag.languages=this.languages.join(","),this}execute(){translate.execute(),this.afterExecuteEvents.forEach(e=>{e()})}translateAISummary(){let{current:e,local:t}=this.getTypesLang();if(typeof tianliGPT_postSelector>"u"||e===t)return;new MutationObserver(s=>{for(let i of s)if(i.type==="childList"){let l=document.querySelector(".tianliGPT-explanation"),r;if(l&&(r=l.querySelector(".blinking-cursor"),r&&l.classList.add("fi-at-ignore")),!l||r)return;l.classList.remove("fi-at-ignore")}}).observe(document.getElementById("content"),{childList:!0,subtree:!0})}translateText({texts:e,from:t,to:a}){return new Promise(s=>{translate.request.translateText({from:t,to:a,texts:e},i=>{if(i.result===1){s(i.text[0]);return}console.error("Translate text error:",i.info),s(i.info)})})}async getBrowserLanguage(){let e=translate.util.browserDefaultLanguage(),t=!0;return e?t=!1:translate.request.post(translate.request.api.ip,{},a=>{if(t=!1,a.result!==0){e=a.language;return}console.log("Can not get the language by ip",a.info)}),new Promise(a=>{let s=setInterval(()=>{t||(clearInterval(s),a(e))},100)})}addLangItem(e){if(!e)return!1;let t=this.getLangNameById(e),a=this.getLangCodeById(e);if(t&&!this.hugoLangCodes.includes(a)&&this.languages.length&&!this.languages.includes(e)){this.languages.push(e);let s=document.createElement("li");return s.classList.add("menu-item"),s.dataset.type="machine",s.innerHTML=`<a data-lang="${e}" class="menu-link" title="${t}"><i class="fa-solid fa-robot fa-fw fa-sm" aria-hidden="true"></i> ${t}</a>`,this.dom.localItems=this.dom.localItems?[...this.dom.localItems,s]:[s],!0}return!1}autoSelectLocalLanguage(){if(this.addLangItem(this.lang.query||this.lang.current),!this.detectLocalLanguage)return;let e=localStorage.getItem("AutoTranslate_detected");if(this.addLangItem(this.lang.browser)){e!=="true"&&!this.lang.query&&(translate.language.setDefaultTo(this.lang.browser),localStorage.setItem("AutoTranslate_detected",!0));return}if(e!=="true"&&!this.lang.query){let t=this.getLangCodeById(this.lang.browser);this.hugoLangCodes.includes(t)&&!window.location.pathname.includes(this.hugoLangMap[t])&&(window.location=this.hugoLangMap[t]),localStorage.setItem("AutoTranslate_detected",!0)}}clearCache(){localStorage.removeItem("AutoTranslate_detected"),translate.language.clearCacheLanguage()}init(){this.getBrowserLanguage().then(e=>{e||(this.detectLocalLanguage=!1),this.lang.browser=e,this.autoSelectLocalLanguage(),this.setup(),this.handle(),this.execute(),this.translateAISummary()})}};fixit.autoTranslate=new o;document.readyState!=="loading"?fixit.autoTranslate.init():document.addEventListener("DOMContentLoaded",()=>fixit.autoTranslate.init(),!1);})();
