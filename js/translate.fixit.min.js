(()=>{var r=!1,o=[],g=[],c=[],h=[],u=[],d="client.edge",m=[];var f=["header-title","language-switch","post-author","powered","author","typeit","katex","katex-display"],L=["repo-url","netease-music","comment-163"],w=["Hugo","FixIt","Lruihao","CC BY-NC-SA","RSS"],l=class{constructor(){this.service=d,this.languages=u,this.ignoreClass=[...f,...L,...o],this.ignoreID=g,this.ignoreTag=c,this.ignoreText=[...w,...h],this.detectLocalLanguage=r,this.isMobile=fixit.util.isMobile(),this.afterExecuteEvents=new Set,this.lang={...this.getTypesLang()},this.supportLanguages={"client.edge":translate.service.edge.language.json,"translate.service":m},this.hugoLangCodes=window.ATConfig.hugoLangCodes,this.hugoLangMap=window.ATConfig.hugoLangMap,this.dom={}}getLangNameById(e){return this.supportLanguages[this.service]?.find(t=>t.id===e)?.name}getLangCodeById(e){return Object.keys(translate.util.browserLanguage).find(t=>translate.util.browserLanguage[t]===e)}getLangIdByCode(e){return translate.util.browserLanguage[e]}getTypesLang(){return{current:translate.language.getCurrent(),local:window.ATConfig.local||translate.language.getLocal(),query:window.location.search.split("lang=")[1],browser:this.lang?.browser||""}}toggleVisibility(e,t){e.classList.toggle("d-none",!t),e.setAttribute("aria-hidden",!t)}toggleMenuActive(e){Array.from(this.dom.switchMenu.childNodes).filter(t=>t.classList.contains("active")).forEach(t=>{t.classList.remove("active")}),e.classList.add("active")}handleDesktop(){if(this.dom.switchDesktop=document.querySelector("#header-desktop .language-switch.auto"),!this.dom.switchDesktop)return;this.dom.switchMenu=this.dom.switchDesktop.querySelector(".sub-menu"),this.dom.localItem&&this.dom.switchMenu.insertBefore(this.dom.localItem,this.dom.switchMenu.querySelector(".menu-item-divider").nextSibling),this.#e(),this.#t();let e=this.dom.switchDesktop.previousElementSibling;e.classList.contains("language-switch")&&this.toggleVisibility(e,!1),this.toggleVisibility(this.dom.switchDesktop,!0),this.afterExecuteEvents.add(()=>{this.lang={...this.getTypesLang()};let{current:t,local:a,query:s}=this.getTypesLang();this.lang={...this.lang,current:t,query:s},(t!==a||s)&&this.toggleMenuActive(document.querySelector(`.menu-link[data-lang="${t}"]`).parentElement)})}#e(){let e=Array.from(this.dom.switchMenu.childNodes).filter(t=>t.dataset.type==="artificial");fixit.util.forEach(e,t=>{if(t.classList.contains("active")&&!t.children[0].getAttribute("title")){let a=this.getLangNameById(this.lang.local);t.children[0].setAttribute("title",a),t.children[0].insertAdjacentText("beforeend",a)}t.addEventListener("click",a=>{translate.language.clearCacheLanguage()})})}#t(){let e=Array.from(this.dom.switchMenu.childNodes).filter(t=>t.dataset.type==="machine");fixit.util.forEach(e,t=>{let a=t.children[0].dataset.lang,s=this.getLangNameById(a),i=this.getLangCodeById(a);if(this.service==="client.edge"&&!s){this.toggleVisibility(t,!1);return}if(this.hugoLangCodes.includes(i)||a==this.lang.local){this.toggleVisibility(t,!1);return}t.addEventListener("click",y=>{window.history.pushState({},"",`?lang=${a}`),this.toggleMenuActive(t),translate.changeLanguage(a)})})}handleMobile(){this.dom.switchMobile=document.querySelector("#header-mobile .language-switch.auto"),this.dom.switchMobile&&(this.#a(),this.afterExecuteEvents.add(()=>{this.dom.selectEl=this.dom.switchMobile.querySelector("select"),this.dom.selectEl.classList.add("language-select"),this.#s(),this.#i();let{current:e,local:t,query:a}=this.getTypesLang();this.lang={...this.lang,current:e,query:a},(e!==t||a)&&(this.dom.selectEl.value=e),this.toggleVisibility(this.dom.switchMobile,!0)}))}#a(){translate.selectLanguageTag.selectOnChange=e=>{let t=e.target.value;e.target.options[e.target.selectedIndex].dataset.type==="artificial"?(translate.language.clearCacheLanguage(),window.location=t):(window.history.pushState({},"",`?lang=${t}`),translate.changeLanguage(t))}}#s(){fixit.util.forEach(this.dom.selectEl.querySelectorAll("option"),e=>{e.dataset.type="machine",e.innerText=`\u{1F916} ${e.innerText}`;let t=this.getLangCodeById(e.value);(this.hugoLangCodes.includes(t)||e.value==this.lang.local)&&e.parentElement.removeChild(e)})}#i(){let e=this.dom.switchMobile.previousElementSibling;if(this.hugoLangCodes.length>1){fixit.util.forEach(e.querySelectorAll("option"),i=>{if(!i.getAttribute("value"))return i.parentElement.removeChild(i);i.dataset.type="artificial",i.innerText=`\u{1F464} ${i.innerText}`,i.disabled&&i.removeAttribute("disabled")}),this.dom.selectEl.prepend(...e.querySelectorAll("option:not([selected])")),this.dom.selectEl.prepend(e.querySelector("option[selected]")),this.toggleVisibility(e,!1);return}let t=this.dom.switchMobile.querySelector('[role="button"]'),a=this.getLangNameById(this.lang.local);t.dataset.current||(t.dataset.current=a,t.insertAdjacentText("afterbegin",a));let s=document.createElement("option");s.selected=!0,s.dataset.type="artificial",s.value=window.location.pathname,s.innerText=`\u{1F464} ${a}`,this.dom.selectEl.prepend(s),this.toggleVisibility(e,!1)}handle(){return this.isMobile?this.handleMobile():this.handleDesktop(),this}setup(){return translate.ignore.id.push(...this.ignoreID),translate.ignore.class.push(...this.ignoreClass),translate.ignore.tag.push(...this.ignoreTag),translate.ignore.text.push(...this.ignoreText),translate.service.use(this.service),translate.language.setLocal(this.lang.local),translate.language.setUrlParamControl("lang"),translate.listener.start(),translate.selectLanguageTag.show=this.isMobile,translate.selectLanguageTag.languages=this.languages.join(","),this}execute(){translate.execute(),this.afterExecuteEvents.forEach(e=>{e()})}async getBrowserLanguage(){let e=translate.util.browserDefaultLanguage(),t=!0;return e?t=!1:translate.request.post(translate.request.api.ip,{},a=>{if(t=!1,a.result!==0){e=a.language;return}console.log("Can not get the language by ip",a.info)}),new Promise(a=>{let s=setInterval(()=>{t||(clearInterval(s),a(e))},100)})}autoSelectLocalLanguage(){if(!this.detectLocalLanguage)return;let e=this.getLangNameById(this.lang.browser),t=this.getLangCodeById(this.lang.browser),a=localStorage.getItem("AutoTranslate_detected");if(e&&!this.hugoLangCodes.includes(t)&&this.languages.length&&!this.languages.includes(this.lang.browser)){this.languages.push(this.lang.browser),this.dom.localItem=document.createElement("li"),this.dom.localItem.classList.add("menu-item"),this.dom.localItem.dataset.type="machine",this.dom.localItem.innerHTML=`<a data-lang="${this.lang.browser}" class="menu-link" title="${e}"><i class="fa-solid fa-robot fa-fw fa-sm" aria-hidden="true"></i> ${e}</a>`,a!=="true"&&(translate.language.setDefaultTo(this.lang.browser),localStorage.setItem("AutoTranslate_detected",!0));return}a!=="true"&&this.hugoLangCodes.includes(t)&&!window.location.pathname.includes(this.hugoLangMap[t])&&(window.location=this.hugoLangMap[t]),a!=="true"&&localStorage.setItem("AutoTranslate_detected",!0)}clearCache(){localStorage.removeItem("AutoTranslate_detected"),translate.language.clearCacheLanguage()}init(){this.getBrowserLanguage().then(e=>{e||(this.detectLocalLanguage=!1),this.lang.browser=e,this.autoSelectLocalLanguage(),this.setup(),this.handle(),this.execute()})}};fixit.autoTranslate=new l;document.readyState!=="loading"?fixit.autoTranslate.init():document.addEventListener("DOMContentLoaded",()=>fixit.autoTranslate.init(),!1);})();
