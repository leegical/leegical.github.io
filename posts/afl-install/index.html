<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=zh-CN><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=2"><meta name=robots content="noodp"><title>Ubuntu 22.04 安装 AFL 及 Qemu Mode 实践 | Leehow的小站</title><meta name=author content="Leehow">
<meta name=description content="Ubuntu 22.04 LTS 64位系统安装 American Fuzzy Lop (AFL) 2.56b 踩坑记录，使用 QEMU mode 进行简单测试实践。"><meta name=keywords content='Ubuntu,Linux,AFL,模糊测试'><meta itemprop=name content="Ubuntu 22.04 安装 AFL 及 qemu mode 实践"><meta itemprop=description content="Ubuntu 22.04 LTS 64位系统安装 American Fuzzy Lop (AFL) 2.56b 踩坑记录，使用 QEMU mode 进行简单测试实践。"><meta itemprop=datePublished content="2023-12-25T21:24:00+08:00"><meta itemprop=dateModified content="2024-11-03T00:53:39+00:00"><meta itemprop=wordCount content="2105"><meta itemprop=image content="https://cdn.haoyep.com/gh/leegical/Blog_img/cdnimg/weblogo.png"><meta itemprop=keywords content="Ubuntu,Linux,AFL,模糊测试"><meta property="og:url" content="https://www.haoyep.com/posts/afl-install/"><meta property="og:site_name" content="Leehow的小站"><meta property="og:title" content="Ubuntu 22.04 安装 AFL 及 qemu mode 实践"><meta property="og:description" content="Ubuntu 22.04 LTS 64位系统安装 American Fuzzy Lop (AFL) 2.56b 踩坑记录，使用 QEMU mode 进行简单测试实践。"><meta property="og:locale" content="zh_CN"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-12-25T21:24:00+08:00"><meta property="article:modified_time" content="2024-11-03T00:53:39+00:00"><meta property="article:tag" content="Ubuntu"><meta property="article:tag" content="Linux"><meta property="article:tag" content="AFL"><meta property="article:tag" content="模糊测试"><meta property="og:image" content="https://cdn.haoyep.com/gh/leegical/Blog_img/cdnimg/weblogo.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://cdn.haoyep.com/gh/leegical/Blog_img/cdnimg/weblogo.png"><meta name=twitter:title content="Ubuntu 22.04 安装 AFL 及 qemu mode 实践"><meta name=twitter:description content="Ubuntu 22.04 LTS 64位系统安装 American Fuzzy Lop (AFL) 2.56b 踩坑记录，使用 QEMU mode 进行简单测试实践。"><meta name=application-name content="Leehow"><meta name=apple-mobile-web-app-title content="Leehow"><meta name=theme-color data-light=#f8f8f8 data-dark=#252627 content="#f8f8f8"><meta name=msapplication-TileColor content="#da532c"><link rel=icon href=https://cdn.haoyep.com/gh/leegical/Blog_img/cdnimg/favicon.svg><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical type=text/html href=https://www.haoyep.com/posts/afl-install/ title="Ubuntu 22.04 安装 AFL 及 qemu mode 实践 | Leehow的小站"><link rel=prev type=text/html href=https://www.haoyep.com/posts/optimize-github-pages-blog-access-speed/ title="Github Pages 博客网站访问速度优化"><link rel=next type=text/html href=https://www.haoyep.com/posts/zsh-config-oh-my-zsh/ title="zsh 安装与配置，使用 oh-my-zsh 美化终端"><link rel=alternate type=text/markdown href=https://www.haoyep.com/posts/afl-install/index.md title="Ubuntu 22.04 安装 AFL 及 qemu mode 实践 | Leehow的小站"><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://unpkg.com/@fortawesome/fontawesome-free@6.4.2/css/all.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://unpkg.com/@fortawesome/fontawesome-free@6.4.2/css/all.min.css></noscript><link rel=preload href=https://unpkg.com/animate.css@4.1.1/animate.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://unpkg.com/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Ubuntu 22.04 安装 AFL 及 qemu mode 实践","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/www.haoyep.com\/posts\/afl-install\/"},"image":["https:\/\/cdn.haoyep.com\/gh\/leegical\/Blog_img\/cdnimg\/202312161447739.ico"],"genre":"posts","keywords":"Ubuntu, Linux, AFL, 模糊测试","wordcount":2105,"url":"https:\/\/www.haoyep.com\/posts\/afl-install\/","datePublished":"2023-12-25T21:24:00+08:00","dateModified":"2024-11-03T00:53:39+00:00","publisher":{"@type":"Organization","name":"Leehow","logo":"https:\/\/cdn.haoyep.com\/gh\/leegical\/Blog_img\/cdnimg\/weblogo.png"},"author":{"@type":"Person","name":"Leehow"},"description":"Ubuntu 22.04 LTS 64位系统安装 American Fuzzy Lop (AFL) 2.56b 踩坑记录，使用 QEMU mode 进行简单测试实践。"}</script><script src=/js/head/color-scheme.min.js></script></head><body data-header-desktop=sticky data-header-mobile=auto><div class=wrapper data-page-style=normal><header class="desktop animate__faster" id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=Leehow的小站><img loading=lazy src=/pokeball.svg alt=Leehow的小站 data-title=Leehow的小站 width=26 height=26 class=logo style="background:url(/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'><span class=header-title-text>Leehow</span></a><span class=header-subtitle>好耶！</span></div><nav><ul class=menu><li class="menu-item has-children"><a class=menu-link href=/archives/><i class="fa-solid fa-feather fa-fw fa-sm" aria-hidden=true></i> 文章</a><i class="dropdown-icon fa-solid fa-chevron-down" aria-hidden=true></i><ul class=sub-menu><li class=menu-item><a class=menu-link href=/categories/><i class="fa-solid fa-folder-tree fa-fw fa-sm" aria-hidden=true></i> 分类</a></li><li class=menu-item><a class=menu-link href=/collections/><i class="fa-solid fa-layer-group fa-fw fa-sm" aria-hidden=true></i> 合集</a></li><li class=menu-item><a class=menu-link href=/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> 标签</a></li></ul></li><li class=menu-item><a class=menu-link href=/friends/ title=友情链接><i class="fa-solid fa-users fa-fw fa-sm" aria-hidden=true></i> 友链</a></li><li class=menu-item><a class=menu-link href=/guestbook/><i class="fa-solid fa-comment-dots fa-fw fa-sm" aria-hidden=true></i> 留言</a></li><li class=menu-item><a class=menu-link href=/about/><i class="fa-solid fa-quote-left fa-fw fa-sm" aria-hidden=true></i> 关于</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id=search-desktop><input type=text placeholder=搜索文章标题或内容…… id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></li></ul></nav></div></header><header class="mobile animate__faster" id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=Leehow的小站><img loading=lazy src=/pokeball.svg alt=Leehow的小站 data-title=Leehow的小站 width=26 height=26 class=logo style="background:url(/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'><span class=header-title-text>Leehow</span></a><span class=header-subtitle>好耶！</span></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><nav><ul class=menu id=menu-mobile><li class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容…… id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></li><li class=menu-item><span class=nested-item><a class=menu-link href=/archives/><i class="fa-solid fa-feather fa-fw fa-sm" aria-hidden=true></i> 文章</a>
<i class="dropdown-icon fa-solid fa-chevron-right" aria-hidden=true></i></span><ul class=sub-menu><li class=menu-item><a class=menu-link href=/categories/><i class="fa-solid fa-folder-tree fa-fw fa-sm" aria-hidden=true></i> 分类</a></li><li class=menu-item><a class=menu-link href=/collections/><i class="fa-solid fa-layer-group fa-fw fa-sm" aria-hidden=true></i> 合集</a></li><li class=menu-item><a class=menu-link href=/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> 标签</a></li></ul></li><li class=menu-item><a class=menu-link href=/friends/ title=友情链接><i class="fa-solid fa-users fa-fw fa-sm" aria-hidden=true></i> 友链</a></li><li class=menu-item><a class=menu-link href=/guestbook/><i class="fa-solid fa-comment-dots fa-fw fa-sm" aria-hidden=true></i> 留言</a></li><li class=menu-item><a class=menu-link href=/about/><i class="fa-solid fa-quote-left fa-fw fa-sm" aria-hidden=true></i> 关于</a></li><li class="menu-item menu-system"><span class="menu-system-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></span></li></ul></nav></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><nav aria-label=breadcrumb class="breadcrumb-container sticky"><ol class=breadcrumb><li class=breadcrumb-item data-separator=/><a href=/posts/ title=Posts>文章</a></li><li class=breadcrumb-item data-separator=/><a href=/posts/%E7%A7%91%E7%A0%94/ title=科研用到的工具、论文、idea等。>科研随想录</a></li><li class="breadcrumb-item active" data-separator=/ aria-current=page>Ubuntu 22.04 安装 AFL 及 Qemu Mode 实践</li></ol></nav><main class=container><aside class="aside-collection animate__animated animate__fadeIn animate__faster" aria-label=合集></aside><article class="page single"><div class=header><h1 class="single-title animate__animated animate__flipInX"><span>Ubuntu 22.04 安装 AFL 及 Qemu Mode 实践</span></h1></div><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://www.haoyep.com/ title=作者 target=_blank rel="external nofollow noopener noreferrer author" class=author><img loading=lazy src=/avatar.jpg alt=Leehow data-title=Leehow width=20 height=20 class=avatar style="background:url(/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'>&nbsp;Leehow</a></span><span class=post-included-in>&nbsp;收录于 <a href=/categories/%E7%A7%91%E7%A0%94/ class=post-category title="分类 - 科研"><i class="fa-regular fa-folder fa-fw" aria-hidden=true></i> 科研</a></span></div><div class=post-meta-line><span title="发布于 2023-12-25 21:24:00"><i class="fa-solid fa-calendar-days fa-fw me-1" aria-hidden=true></i><time datetime=2023-12-25>2023-12-25</time></span>&nbsp;<span title="更新于 2024-11-03 00:53:39"><i class="fa-regular fa-calendar-check fa-fw me-1" aria-hidden=true></i><time datetime=2024-11-03>2024-11-03</time></span>&nbsp;<span title="2105 字"><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden=true></i>约 2200 字</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden=true></i>预计阅读 5 分钟</span>&nbsp;<span id=busuanzi_container_page_pv class="busuanzi_visitors comment-visitors" data-flag-title="Ubuntu 22.04 安装 AFL 及 Qemu Mode 实践"><i class="fa-regular fa-eye fa-fw me-1" aria-hidden=true></i><span id=busuanzi_value_page_pv>-</span>&nbsp;次阅读
</span>&nbsp;</div></div><div class=featured-image><img loading=lazy src=https://cdn.haoyep.com/gh/leegical/Blog_img/cdnimg/202401171443369.png alt=https://cdn.haoyep.com/gh/leegical/Blog_img/cdnimg/202401171443369.png data-title="Ubuntu 22.04 LTS 64位系统安装 American Fuzzy Lop (AFL) 2.56b 踩坑记录，使用 QEMU mode 进行简单测试实践。" style="background:url(/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></div><div class="details toc" id=toc-static data-kept=false><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fa-solid fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ol><li><a href=#安装依赖>安装依赖</a><ol><li><a href=#添加环境变量-path>添加环境变量 Path</a></li><li><a href=#设置-python>设置 Python</a></li><li><a href=#安装-clang10>安装 clang10</a></li></ol></li><li><a href=#安装-z3>安装 Z3</a></li><li><a href=#安装-afl>安装 AFL</a><ol><li><a href=#安装-qemu-模式>安装 qemu 模式</a><ol><li><a href=#依赖环境>依赖环境</a></li><li><a href=#patch-代码>patch 代码</a></li><li><a href=#修改脚本>修改脚本</a></li><li><a href=#编译及安装>编译及安装</a></li></ol></li><li><a href=#运行-qemu-mode>运行 qemu mode</a><ol><li><a href=#停止运行>停止运行</a></li></ol></li></ol></li><li><a href=#失败报错解决方案>失败报错解决方案</a><ol><li><a href=#core_pattern>core_pattern</a></li><li><a href=#cpu-frequency>CPU frequency</a></li></ol></li></ol></nav></div></div><div class=content id=content data-end-flag=（本文完）><p>Ubuntu 22.04 LTS 64位系统安装 American Fuzzy Lop (AFL) 2.56b 踩坑记录，使用 QEMU mode 进行简单测试实践。</p><h2 id=安装依赖 class=heading-element><span>1 安装依赖</span>
<a href=#%e5%ae%89%e8%a3%85%e4%be%9d%e8%b5%96 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo apt update
</span></span><span class=line><span class=cl>sudo apt-get install -y cargo <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>						python2 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>                        cmake <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>                        g++ <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>                        git <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>                        bison <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>                        libz3-dev  <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>                        ninja-build <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>                        python3-pip <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>                        zlib1g-dev
</span></span><span class=line><span class=cl>pip3 install lit</span></span></code></pre></td></tr></table></div></div><h3 id=添加环境变量-path class=heading-element><span>1.1 添加环境变量 Path</span>
<a href=#%e6%b7%bb%e5%8a%a0%e7%8e%af%e5%a2%83%e5%8f%98%e9%87%8f-path class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>编辑终端配置文件。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># bash
</span></span><span class=line><span class=cl>sudo nano ~/.bashrc
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># zsh
</span></span><span class=line><span class=cl>sudo nano ~/zshrc</span></span></code></pre></td></tr></table></div></div><p>添加环境变量：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>export</span> <span class=nv>PATH</span><span class=o>=</span><span class=si>${</span><span class=nv>HOME</span><span class=si>}</span>/.local/bin:<span class=si>${</span><span class=nv>PATH</span><span class=si>}</span></span></span></code></pre></td></tr></table></div></div><p><figure><a class=lightgallery href="https://cdn.haoyep.com/gh/leegical/Blog_img/cdnimg/202401071608420.png?size=large" data-thumbnail="https://cdn.haoyep.com/gh/leegical/Blog_img/cdnimg/202401071608420.png?size=small" data-sub-html="<h2> </h2><p>编辑Path变量</p>"><img loading=lazy src=https://cdn.haoyep.com/gh/leegical/Blog_img/cdnimg/202401071608420.png alt=编辑Path变量 srcset="https://cdn.haoyep.com/gh/leegical/Blog_img/cdnimg/202401071608420.png?size=small, https://cdn.haoyep.com/gh/leegical/Blog_img/cdnimg/202401071608420.png?size=medium 1.5x, https://cdn.haoyep.com/gh/leegical/Blog_img/cdnimg/202401071608420.png?size=large 2x" data-title=编辑Path变量 style="background:url(/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>编辑Path变量</figcaption></figure></p><p>启用配置文件，<strong>bash</strong> 使用<code>source ~/.bashrc</code>；<strong>zsh</strong> 使用<code>~/.zshrc</code>。</p><h3 id=设置-python class=heading-element><span>1.2 设置 Python</span>
<a href=#%e8%ae%be%e7%bd%ae-python class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>AFL 使用的是 Python2，Ubuntu22.04 上没有安装。因此需要安装 Python2并将其设置为默认 Python。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo ln -s /usr/bin/python2 /usr/bin/python</span></span></code></pre></td></tr></table></div></div><h3 id=安装-clang10 class=heading-element><span>1.3 安装 clang10</span>
<a href=#%e5%ae%89%e8%a3%85-clang10 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>参考此文章安装并设置 <code>clang10</code> 为默认版本。</p><a href=https://www.haoyep.com/posts/ubuntu22-install-clang10/ title="Ubuntu 22.04 LTS 64位系统安装 clang10 版本" target=_blank rel="external nofollow noopener noreferrer" class=card-link><span class=cl-backdrop style=--cl-bg-url:url(/images/fixit.min.svg)></span>
<span class=cl-content><span class=cl-text><span class=cl-title>Ubuntu 22.04 LTS 64位系统安装 clang10 版本</span>
<span class=cl-meta><svg class="cl-icon-link" viewBox="0 0 1024 1024" width="16" height="16"><path d="M574 665.4c-3.1-3.1-8.2-3.1-11.3.0L446.5 781.6c-53.8 53.8-144.6 59.5-204 0-59.5-59.5-53.8-150.2.0-204l116.2-116.2c3.1-3.1 3.1-8.2.0-11.3l-39.8-39.8c-3.1-3.1-8.2-3.1-11.3.0L191.4 526.5c-84.6 84.6-84.6 221.5.0 306s221.5 84.6 306 0l116.2-116.2c3.1-3.1 3.1-8.2.0-11.3L574 665.4zm258.6-474c-84.6-84.6-221.5-84.6-306 0L410.3 307.6c-3.1 3.1-3.1 8.2.0 11.3l39.7 39.7c3.1 3.1 8.2 3.1 11.3.0l116.2-116.2c53.8-53.8 144.6-59.5 204 0 59.5 59.5 53.8 150.2.0 204L665.3 562.6c-3.1 3.1-3.1 8.2.0 11.3l39.8 39.8c3.1 3.1 8.2 3.1 11.3.0l116.2-116.2c84.5-84.6 84.5-221.5.0-306.1z" fill="#a9a9b3"/><path d="M610.1 372.3c-3.1-3.1-8.2-3.1-11.3.0L372.3 598.7c-3.1 3.1-3.1 8.2.0 11.3l39.6 39.6c3.1 3.1 8.2 3.1 11.3.0l226.4-226.4c3.1-3.1 3.1-8.2.0-11.3l-39.5-39.6z" fill="#a9a9b3"/></svg>
<span class=cl-url>https://www.haoyep.com/posts/ubuntu22-install-clang10/</span></span></span><svg class="cl-shortcut-icon" viewBox="0 0 1024 1024" width="64" height="64"><path d="M960 512c0 249.408-203.2 448-448 448-244.778667.0-448-198.592-448-448S262.592 64 512 64s448 198.592 448 448" fill="#2196f3"/><path d="M507.52 718.08c0-8.96-4.48-13.44-13.44-17.92-26.88-8.96-53.76-8.96-76.16-31.381333-4.48-8.96-4.48-17.92-8.96-26.88-8.96-8.96-31.36-13.44-44.8-17.92h-89.6c-13.44-4.48-22.4-22.4-31.36-35.84.0-4.48.0-13.461333-8.96-13.461334-8.96-4.458667-17.92 4.501333-26.88.0-4.48-4.458667-4.48-8.96-4.48-13.418666.0-13.461333 8.96-26.901333 17.92-35.861334 13.44-8.96 26.88 4.48 40.32 4.48 4.48.0 4.48.0 8.96 4.48 13.44 4.48 17.92 22.4 17.92 35.861334v8.96c0 4.48 4.48 4.48 8.96 4.48 4.48-22.4 4.48-44.821333 8.96-67.2.0-26.88 26.88-53.781333 49.28-62.72 8.96-4.458667 13.44 4.501333 22.4.0 26.88-8.96 94.08-35.84 80.64-71.658667-8.96-31.381333-35.84-62.698667-71.68-58.24-8.96 4.501333-13.44 8.96-22.4 13.461333-13.44 8.96-40.32 35.84-53.76 35.84-22.4-4.48-22.4-35.84-17.92-49.301333 4.48-17.92 44.8-76.138667 71.68-67.178667l17.92 17.92c8.96 4.48 22.4 4.48 35.84 4.48 4.48.0 8.96.0 13.44-4.48s4.48-4.48 4.48-8.96c0-13.44-13.44-26.901333-22.4-35.861333s-22.4-17.92-35.84-22.378667c-44.8-13.461333-116.48 4.458667-152.32 35.84-35.84 31.36-62.72 85.12-80.64 129.92-8.96 26.88-17.92 62.698667-22.4 94.08-4.48 22.4-8.96 40.32 4.48 62.698667 13.44 26.88 40.32 53.781333 67.2 71.68 17.92 13.44 53.76 13.44 71.68 35.84 13.44 17.941333 8.96 40.32 8.96 62.72.0 26.88 17.92 49.28 26.88 71.658667C305.92 785.28 310.4 803.2 314.88 816.64c0 4.48 4.48 31.36 4.48 35.84 26.88 13.44 49.28 26.901333 80.64 35.861333 4.48.0 22.4-26.901333 22.4-31.381333 13.44-13.44 22.4-31.36 35.84-40.32 8.96-4.48 17.92-8.96 26.88-17.941333 8.96-8.96 13.44-26.88 17.92-40.32C507.52 749.44 512 731.52 507.52 718.08M516.48 305.92c4.48.0 8.96-4.48 17.92-8.96 13.44-8.96 26.901333-22.4 40.32-31.36 13.461333-8.96 26.901333-22.4 35.861333-31.36 13.44-8.96 22.4-26.88 26.88-40.341333 4.48-8.96 17.941333-26.88 13.44-40.32-4.48-8.96-26.88-13.44-35.84-17.92C579.2 126.698667 547.84 122.24 512 122.24c-13.44.0-31.36 4.458667-35.84 17.92-4.48 22.4 13.44 17.92 31.36 22.4.0.0 4.48 35.84 4.48 40.32 4.48 22.421333-8.96 35.84-8.96 58.24.0 13.44.0 35.84 8.96 44.8h4.48zM892.8 619.52c4.501333-8.96 4.501333-22.4 8.96-31.36 4.501333-22.421333 4.501333-44.8 4.501333-67.2.0-44.8-4.501333-89.578667-17.92-129.92-8.96-13.44-13.461333-26.88-17.941333-40.341333C861.44 328.32 848 305.898667 830.08 288c-17.92-22.4-40.341333-85.12-80.64-67.2-13.44 4.501333-22.4 22.421333-31.36 31.381333l-26.88 40.32c-4.501333 4.48-8.96 13.44-4.501333 17.92.0 4.48 4.501333 4.48 8.96 4.48 8.96 4.501333 13.461333 4.501333 22.421333 8.96 4.48.0 8.96 4.501333 4.48 8.96.0.0.0 4.501333-4.48 4.501334-22.421333 22.4-44.8 40.32-67.2 62.698666-4.48 4.48-8.96 13.44-8.96 17.92s4.48 4.48 4.48 8.96c0 4.501333-4.48 4.501333-8.96 8.96-8.96 4.501333-17.92 8.96-22.4 13.461334-4.48 8.96.0 22.4-4.48 31.36-4.48 22.4-17.941333 40.32-26.901333 62.72-8.96 13.418667-13.418667 26.88-22.378667 40.32.0 17.92-4.501333 31.36 4.458667 44.8 22.421333 31.36 62.72 13.44 94.08 26.901333 8.96 4.458667 17.92 4.458667 22.421333 13.418667C695.658667 682.304 695.658667 704.704 700.16 718.144c4.458667 17.92 8.96 35.84 17.92 53.76 4.48 22.421333 13.44 44.821333 17.92 62.72 40.341333-31.36 76.16-67.178667 103.04-112 26.88-31.424 40.341333-67.242667 53.76-103.104" fill="#cddc39"/></svg></span></a><h2 id=安装-z3 class=heading-element><span>2 安装 Z3</span>
<a href=#%e5%ae%89%e8%a3%85-z3 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>要求版本号大于4.5</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>git clone https://github.com/Z3Prover/z3.git
</span></span><span class=line><span class=cl><span class=nb>cd</span> z3 <span class=o>&amp;&amp;</span> mkdir build <span class=o>&amp;&amp;</span> <span class=nb>cd</span> build
</span></span><span class=line><span class=cl>cmake -G <span class=s2>&#34;Ninja&#34;</span> ../
</span></span><span class=line><span class=cl>ninja</span></span></code></pre></td></tr></table></div></div><div class="details admonition warning open"><div class="details-summary admonition-title"><i class="icon fa-fw fa-solid fa-exclamation-triangle" aria-hidden=true></i>Git Clone错误解决方案<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content><ul><li><p><strong>执行 git clone 报错</strong>：
<code>fatal: unable to access ' https://github.com/Z3Prover/z3/ ': GnuTLS recv error (-110): The TLS connection was non-properly terminated.</code></p></li><li><p><strong>解决方案</strong></p></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo apt-get update
</span></span><span class=line><span class=cl>sudo apt-get install gnutls-bin
</span></span><span class=line><span class=cl>git config --global http.sslVerify <span class=nb>false</span>
</span></span><span class=line><span class=cl>git config --global http.postBuffer <span class=m>1048576000</span></span></span></code></pre></td></tr></table></div></div><p>到此问题解决，重新进行<code>git clone</code>，可以顺畅下载。</p></div></div></div><h2 id=安装-afl class=heading-element><span>3 安装 AFL</span>
<a href=#%e5%ae%89%e8%a3%85-afl class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>git clone -b v2.56b https://github.com/google/AFL.git afl
</span></span><span class=line><span class=cl><span class=nb>cd</span> afl <span class=o>&amp;&amp;</span> make</span></span></code></pre></td></tr></table></div></div><p><figure><a class=lightgallery href="https://cdn.haoyep.com/gh/leegical/Blog_img/md_img202312132214349.png?size=large" data-thumbnail="https://cdn.haoyep.com/gh/leegical/Blog_img/md_img202312132214349.png?size=small" data-sub-html="<h2> </h2><p>afl工具列表</p>"><img loading=lazy src=https://cdn.haoyep.com/gh/leegical/Blog_img/md_img202312132214349.png alt=afl工具列表 srcset="https://cdn.haoyep.com/gh/leegical/Blog_img/md_img202312132214349.png?size=small, https://cdn.haoyep.com/gh/leegical/Blog_img/md_img202312132214349.png?size=medium 1.5x, https://cdn.haoyep.com/gh/leegical/Blog_img/md_img202312132214349.png?size=large 2x" data-title=afl工具列表 style="background:url(/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>afl工具列表</figcaption></figure></p><h3 id=安装-qemu-模式 class=heading-element><span>3.1 安装 qemu 模式</span>
<a href=#%e5%ae%89%e8%a3%85-qemu-%e6%a8%a1%e5%bc%8f class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>编译 qemu，支持二进制文件黑盒分析。</p><h4 id=依赖环境 class=heading-element><span>3.1.1 依赖环境</span>
<a href=#%e4%be%9d%e8%b5%96%e7%8e%af%e5%a2%83 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>安装 libtool 等资源库</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo apt-get install libtool-bin libgtk2.0-dev -y</span></span></code></pre></td></tr></table></div></div><h4 id=patch-代码 class=heading-element><span>3.1.2 patch 代码</span>
<a href=#patch-%e4%bb%a3%e7%a0%81 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>为了避免 <a href=https://github.com/google/AFL/issues/41 target=_blank rel="external nofollow noopener noreferrer">AFL/issues/41<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a> 中出现的<code>error: ‘SIOCGSTAMP’ undeclared here (not in a function); did you mean ‘SIOCSRARP’?</code>、<code>error: ‘SIOCGSTAMPNS’ undeclared here (not in a function); did you mean ‘SIOCGSTAMP_OLD’?</code>，需要修改为 <a href=https://github.com/Mindavi/AFL/blob/6c917e3d63a2a0685d58c3518524f9615b001893/qemu_mode/patches/syscall.diff target=_blank rel="external nofollow noopener noreferrer">patch<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a> 中的文件内容。修改 <code>afl/qemu_mode/patches</code>目录中的<code>syscall.diff</code>文件内容如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=o>---</span> <span class=n>qemu</span><span class=o>-</span><span class=mf>2.10</span><span class=o>.</span><span class=mi>0</span><span class=o>-</span><span class=n>clean</span><span class=o>/</span><span class=n>linux</span><span class=o>-</span><span class=n>user</span><span class=o>/</span><span class=n>syscall</span><span class=o>.</span><span class=n>c</span>	<span class=mi>2020</span><span class=o>-</span><span class=mi>03</span><span class=o>-</span><span class=mi>12</span> <span class=mi>18</span><span class=p>:</span><span class=mi>47</span><span class=p>:</span><span class=mf>47.898592169</span> <span class=o>+</span><span class=mi>0100</span>
</span></span><span class=line><span class=cl><span class=o>+++</span> <span class=n>qemu</span><span class=o>-</span><span class=mf>2.10</span><span class=o>.</span><span class=mi>0</span><span class=o>/</span><span class=n>linux</span><span class=o>-</span><span class=n>user</span><span class=o>/</span><span class=n>syscall</span><span class=o>.</span><span class=n>c</span>	<span class=mi>2020</span><span class=o>-</span><span class=mi>03</span><span class=o>-</span><span class=mi>12</span> <span class=mi>19</span><span class=p>:</span><span class=mi>16</span><span class=p>:</span><span class=mf>41.563074307</span> <span class=o>+</span><span class=mi>0100</span>
</span></span><span class=line><span class=cl><span class=err>@@</span> <span class=o>-</span><span class=mi>34</span><span class=p>,</span><span class=mi>6</span> <span class=o>+</span><span class=mi>34</span><span class=p>,</span><span class=mi>7</span> <span class=err>@@</span>
</span></span><span class=line><span class=cl> <span class=c1>#include &lt;sys/resource.h&gt;</span>
</span></span><span class=line><span class=cl> <span class=c1>#include &lt;sys/swap.h&gt;</span>
</span></span><span class=line><span class=cl> <span class=c1>#include &lt;linux/capability.h&gt;</span>
</span></span><span class=line><span class=cl><span class=o>+</span><span class=c1>#include &lt;linux/sockios.h&gt; // https://lkml.org/lkml/2019/6/3/988</span>
</span></span><span class=line><span class=cl> <span class=c1>#include &lt;sched.h&gt;</span>
</span></span><span class=line><span class=cl> <span class=c1>#include &lt;sys/timex.h&gt;</span>
</span></span><span class=line><span class=cl> <span class=c1>#ifdef __ia64__</span>
</span></span><span class=line><span class=cl><span class=err>@@</span> <span class=o>-</span><span class=mi>116</span><span class=p>,</span><span class=mi>6</span> <span class=o>+</span><span class=mi>117</span><span class=p>,</span><span class=mi>8</span> <span class=err>@@</span> <span class=ne>int</span> <span class=n>__clone2</span><span class=p>(</span><span class=ne>int</span> <span class=p>(</span><span class=o>*</span><span class=n>fn</span><span class=p>)(</span><span class=n>void</span> <span class=o>*</span><span class=p>),</span> <span class=n>void</span> <span class=o>*</span><span class=n>ch</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl> <span class=c1>#include &#34;qemu.h&#34;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=o>+</span><span class=n>extern</span> <span class=n>unsigned</span> <span class=ne>int</span> <span class=n>afl_forksrv_pid</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=o>+</span>
</span></span><span class=line><span class=cl> <span class=c1>#ifndef CLONE_IO</span>
</span></span><span class=line><span class=cl> <span class=c1>#define CLONE_IO                0x80000000      /* Clone io context */</span>
</span></span><span class=line><span class=cl> <span class=c1>#endif</span>
</span></span><span class=line><span class=cl><span class=err>@@</span> <span class=o>-</span><span class=mi>256</span><span class=p>,</span><span class=mi>7</span> <span class=o>+</span><span class=mi>259</span><span class=p>,</span><span class=mi>9</span> <span class=err>@@</span> <span class=k>static</span> <span class=n>type</span> <span class=n>name</span> <span class=p>(</span><span class=n>type1</span> <span class=n>arg1</span><span class=p>,</span><span class=n>type2</span> <span class=n>arg2</span><span class=p>,</span>
</span></span><span class=line><span class=cl> <span class=c1>#endif</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl> <span class=c1>#ifdef __NR_gettid</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>_syscall0</span><span class=p>(</span><span class=ne>int</span><span class=p>,</span> <span class=n>gettid</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=o>+//</span> <span class=n>taken</span> <span class=n>from</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>patchwork</span><span class=o>.</span><span class=n>kernel</span><span class=o>.</span><span class=n>org</span><span class=o>/</span><span class=n>patch</span><span class=o>/</span><span class=mi>10862231</span><span class=o>/</span>
</span></span><span class=line><span class=cl><span class=o>+</span><span class=c1>#define __NR_sys_gettid __NR_gettid</span>
</span></span><span class=line><span class=cl><span class=o>+</span><span class=n>_syscall0</span><span class=p>(</span><span class=ne>int</span><span class=p>,</span> <span class=n>sys_gettid</span><span class=p>)</span>
</span></span><span class=line><span class=cl> <span class=c1>#else</span>
</span></span><span class=line><span class=cl> <span class=o>/*</span> <span class=n>This</span> <span class=n>is</span> <span class=n>a</span> <span class=n>replacement</span> <span class=k>for</span> <span class=n>the</span> <span class=n>host</span> <span class=n>gettid</span><span class=p>()</span> <span class=ow>and</span> <span class=n>must</span> <span class=k>return</span> <span class=n>a</span> <span class=n>host</span>
</span></span><span class=line><span class=cl>    <span class=n>errno</span><span class=o>.</span> <span class=o>*/</span>
</span></span><span class=line><span class=cl><span class=err>@@</span> <span class=o>-</span><span class=mi>6219</span><span class=p>,</span><span class=mi>7</span> <span class=o>+</span><span class=mi>6224</span><span class=p>,</span><span class=mi>8</span> <span class=err>@@</span> <span class=k>static</span> <span class=n>void</span> <span class=o>*</span><span class=n>clone_func</span><span class=p>(</span><span class=n>void</span> <span class=o>*</span><span class=n>arg</span><span class=p>)</span>
</span></span><span class=line><span class=cl>     <span class=n>cpu</span> <span class=o>=</span> <span class=n>ENV_GET_CPU</span><span class=p>(</span><span class=n>env</span><span class=p>);</span>
</span></span><span class=line><span class=cl>     <span class=n>thread_cpu</span> <span class=o>=</span> <span class=n>cpu</span><span class=p>;</span>
</span></span><span class=line><span class=cl>     <span class=n>ts</span> <span class=o>=</span> <span class=p>(</span><span class=n>TaskState</span> <span class=o>*</span><span class=p>)</span><span class=n>cpu</span><span class=o>-&gt;</span><span class=n>opaque</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=o>-</span>    <span class=n>info</span><span class=o>-&gt;</span><span class=n>tid</span> <span class=o>=</span> <span class=n>gettid</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=o>+</span>    <span class=o>//</span> <span class=n>taken</span> <span class=n>from</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>patchwork</span><span class=o>.</span><span class=n>kernel</span><span class=o>.</span><span class=n>org</span><span class=o>/</span><span class=n>patch</span><span class=o>/</span><span class=mi>10862231</span><span class=o>/</span>
</span></span><span class=line><span class=cl><span class=o>+</span>    <span class=n>info</span><span class=o>-&gt;</span><span class=n>tid</span> <span class=o>=</span> <span class=n>sys_gettid</span><span class=p>();</span>
</span></span><span class=line><span class=cl>     <span class=n>task_settid</span><span class=p>(</span><span class=n>ts</span><span class=p>);</span>
</span></span><span class=line><span class=cl>     <span class=k>if</span> <span class=p>(</span><span class=n>info</span><span class=o>-&gt;</span><span class=n>child_tidptr</span><span class=p>)</span>
</span></span><span class=line><span class=cl>         <span class=n>put_user_u32</span><span class=p>(</span><span class=n>info</span><span class=o>-&gt;</span><span class=n>tid</span><span class=p>,</span> <span class=n>info</span><span class=o>-&gt;</span><span class=n>child_tidptr</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=err>@@</span> <span class=o>-</span><span class=mi>6363</span><span class=p>,</span><span class=mi>9</span> <span class=o>+</span><span class=mi>6369</span><span class=p>,</span><span class=mi>11</span> <span class=err>@@</span> <span class=k>static</span> <span class=ne>int</span> <span class=n>do_fork</span><span class=p>(</span><span class=n>CPUArchState</span> <span class=o>*</span><span class=n>env</span><span class=p>,</span> <span class=n>un</span>
</span></span><span class=line><span class=cl>                <span class=n>mapping</span><span class=o>.</span>  <span class=n>We</span> <span class=n>can</span><span class=s1>&#39;t repeat the spinlock hack used above because</span>
</span></span><span class=line><span class=cl>                <span class=n>the</span> <span class=n>child</span> <span class=n>process</span> <span class=n>gets</span> <span class=n>its</span> <span class=n>own</span> <span class=n>copy</span> <span class=n>of</span> <span class=n>the</span> <span class=n>lock</span><span class=o>.</span>  <span class=o>*/</span>
</span></span><span class=line><span class=cl>             <span class=k>if</span> <span class=p>(</span><span class=n>flags</span> <span class=o>&amp;</span> <span class=n>CLONE_CHILD_SETTID</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=o>-</span>                <span class=n>put_user_u32</span><span class=p>(</span><span class=n>gettid</span><span class=p>(),</span> <span class=n>child_tidptr</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=o>+</span>                <span class=o>//</span> <span class=n>taken</span> <span class=n>from</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>patchwork</span><span class=o>.</span><span class=n>kernel</span><span class=o>.</span><span class=n>org</span><span class=o>/</span><span class=n>patch</span><span class=o>/</span><span class=mi>10862231</span><span class=o>/</span>
</span></span><span class=line><span class=cl><span class=o>+</span>                <span class=n>put_user_u32</span><span class=p>(</span><span class=n>sys_gettid</span><span class=p>(),</span> <span class=n>child_tidptr</span><span class=p>);</span>
</span></span><span class=line><span class=cl>             <span class=k>if</span> <span class=p>(</span><span class=n>flags</span> <span class=o>&amp;</span> <span class=n>CLONE_PARENT_SETTID</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=o>-</span>                <span class=n>put_user_u32</span><span class=p>(</span><span class=n>gettid</span><span class=p>(),</span> <span class=n>parent_tidptr</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=o>+</span>                <span class=o>//</span> <span class=n>taken</span> <span class=n>from</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>patchwork</span><span class=o>.</span><span class=n>kernel</span><span class=o>.</span><span class=n>org</span><span class=o>/</span><span class=n>patch</span><span class=o>/</span><span class=mi>10862231</span><span class=o>/</span>
</span></span><span class=line><span class=cl><span class=o>+</span>                <span class=n>put_user_u32</span><span class=p>(</span><span class=n>sys_gettid</span><span class=p>(),</span> <span class=n>parent_tidptr</span><span class=p>);</span>
</span></span><span class=line><span class=cl>             <span class=n>ts</span> <span class=o>=</span> <span class=p>(</span><span class=n>TaskState</span> <span class=o>*</span><span class=p>)</span><span class=n>cpu</span><span class=o>-&gt;</span><span class=n>opaque</span><span class=p>;</span>
</span></span><span class=line><span class=cl>             <span class=k>if</span> <span class=p>(</span><span class=n>flags</span> <span class=o>&amp;</span> <span class=n>CLONE_SETTLS</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                 <span class=n>cpu_set_tls</span> <span class=p>(</span><span class=n>env</span><span class=p>,</span> <span class=n>newtls</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=err>@@</span> <span class=o>-</span><span class=mi>11402</span><span class=p>,</span><span class=mi>7</span> <span class=o>+</span><span class=mi>11410</span><span class=p>,</span><span class=mi>8</span> <span class=err>@@</span> <span class=n>abi_long</span> <span class=n>do_syscall</span><span class=p>(</span><span class=n>void</span> <span class=o>*</span><span class=n>cpu_env</span><span class=p>,</span> <span class=ne>int</span> <span class=n>n</span>
</span></span><span class=line><span class=cl>         <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl> <span class=c1>#endif</span>
</span></span><span class=line><span class=cl>     <span class=k>case</span> <span class=n>TARGET_NR_gettid</span><span class=p>:</span>
</span></span><span class=line><span class=cl><span class=o>-</span>        <span class=n>ret</span> <span class=o>=</span> <span class=n>get_errno</span><span class=p>(</span><span class=n>gettid</span><span class=p>());</span>
</span></span><span class=line><span class=cl><span class=o>+</span>        <span class=o>//</span> <span class=n>taken</span> <span class=n>from</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>patchwork</span><span class=o>.</span><span class=n>kernel</span><span class=o>.</span><span class=n>org</span><span class=o>/</span><span class=n>patch</span><span class=o>/</span><span class=mi>10862231</span><span class=o>/</span>
</span></span><span class=line><span class=cl><span class=o>+</span>        <span class=n>ret</span> <span class=o>=</span> <span class=n>get_errno</span><span class=p>(</span><span class=n>sys_gettid</span><span class=p>());</span>
</span></span><span class=line><span class=cl>         <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl> <span class=c1>#ifdef TARGET_NR_readahead</span>
</span></span><span class=line><span class=cl>     <span class=k>case</span> <span class=n>TARGET_NR_readahead</span><span class=p>:</span>
</span></span><span class=line><span class=cl><span class=err>@@</span> <span class=o>-</span><span class=mi>11688</span><span class=p>,</span><span class=mi>8</span> <span class=o>+</span><span class=mi>11697</span><span class=p>,</span><span class=mi>20</span> <span class=err>@@</span> <span class=n>abi_long</span> <span class=n>do_syscall</span><span class=p>(</span><span class=n>void</span> <span class=o>*</span><span class=n>cpu_env</span><span class=p>,</span> <span class=ne>int</span> <span class=n>n</span>
</span></span><span class=line><span class=cl>         <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>     <span class=k>case</span> <span class=n>TARGET_NR_tgkill</span><span class=p>:</span>
</span></span><span class=line><span class=cl><span class=o>-</span>        <span class=n>ret</span> <span class=o>=</span> <span class=n>get_errno</span><span class=p>(</span><span class=n>safe_tgkill</span><span class=p>((</span><span class=ne>int</span><span class=p>)</span><span class=n>arg1</span><span class=p>,</span> <span class=p>(</span><span class=ne>int</span><span class=p>)</span><span class=n>arg2</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=o>-</span>                        <span class=n>target_to_host_signal</span><span class=p>(</span><span class=n>arg3</span><span class=p>)));</span>
</span></span><span class=line><span class=cl><span class=o>+</span>        <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=o>+</span>          <span class=ne>int</span> <span class=n>pid</span>  <span class=o>=</span> <span class=p>(</span><span class=ne>int</span><span class=p>)</span><span class=n>arg1</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=o>+</span>              <span class=n>tgid</span> <span class=o>=</span> <span class=p>(</span><span class=ne>int</span><span class=p>)</span><span class=n>arg2</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=o>+</span>              <span class=n>sig</span>  <span class=o>=</span> <span class=p>(</span><span class=ne>int</span><span class=p>)</span><span class=n>arg3</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=o>+</span>
</span></span><span class=line><span class=cl><span class=o>+</span>          <span class=o>/*</span> <span class=n>Not</span> <span class=n>entirely</span> <span class=n>sure</span> <span class=k>if</span> <span class=n>the</span> <span class=n>below</span> <span class=n>is</span> <span class=n>correct</span> <span class=k>for</span> <span class=n>all</span> <span class=n>architectures</span><span class=o>.</span> <span class=o>*/</span>
</span></span><span class=line><span class=cl><span class=o>+</span>
</span></span><span class=line><span class=cl><span class=o>+</span>          <span class=k>if</span><span class=p>(</span><span class=n>afl_forksrv_pid</span> <span class=o>&amp;&amp;</span> <span class=n>afl_forksrv_pid</span> <span class=o>==</span> <span class=n>pid</span> <span class=o>&amp;&amp;</span> <span class=n>sig</span> <span class=o>==</span> <span class=n>SIGABRT</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=o>+</span>              <span class=n>pid</span> <span class=o>=</span> <span class=n>tgid</span> <span class=o>=</span> <span class=n>getpid</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=o>+</span>
</span></span><span class=line><span class=cl><span class=o>+</span>          <span class=n>ret</span> <span class=o>=</span> <span class=n>get_errno</span><span class=p>(</span><span class=n>safe_tgkill</span><span class=p>(</span><span class=n>pid</span><span class=p>,</span> <span class=n>tgid</span><span class=p>,</span> <span class=n>target_to_host_signal</span><span class=p>(</span><span class=n>sig</span><span class=p>)));</span>
</span></span><span class=line><span class=cl><span class=o>+</span>
</span></span><span class=line><span class=cl><span class=o>+</span>        <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=o>+</span>
</span></span><span class=line><span class=cl>         <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl> <span class=c1>#ifdef TARGET_NR_set_robust_list</span></span></span></code></pre></td></tr></table></div></div><p><figure><a class=lightgallery href="https://cdn.haoyep.com/gh/leegical/Blog_img/md_img202312132314613.png?size=large" data-thumbnail="https://cdn.haoyep.com/gh/leegical/Blog_img/md_img202312132314613.png?size=small" data-sub-html="<h2> </h2><p>替换syscall.diff文件内容</p>"><img loading=lazy src=https://cdn.haoyep.com/gh/leegical/Blog_img/md_img202312132314613.png alt=替换syscall.diff文件内容 srcset="https://cdn.haoyep.com/gh/leegical/Blog_img/md_img202312132314613.png?size=small, https://cdn.haoyep.com/gh/leegical/Blog_img/md_img202312132314613.png?size=medium 1.5x, https://cdn.haoyep.com/gh/leegical/Blog_img/md_img202312132314613.png?size=large 2x" data-title=替换syscall.diff文件内容 style="background:url(/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>替换syscall.diff文件内容</figcaption></figure></p><p>在 <code>afl/qemu_mode/patches</code>目录中新增<code>memfd_create.diff</code>文件，内容如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>diff</span> <span class=o>-</span><span class=n>ru</span> <span class=n>qemu</span><span class=o>-</span><span class=mf>2.10</span><span class=o>.</span><span class=mi>0</span><span class=o>-</span><span class=n>clean</span><span class=o>/</span><span class=n>util</span><span class=o>/</span><span class=n>memfd</span><span class=o>.</span><span class=n>c</span> <span class=n>qemu</span><span class=o>-</span><span class=mf>2.10</span><span class=o>.</span><span class=mi>0</span><span class=o>/</span><span class=n>util</span><span class=o>/</span><span class=n>memfd</span><span class=o>.</span><span class=n>c</span>
</span></span><span class=line><span class=cl><span class=o>---</span> <span class=n>qemu</span><span class=o>-</span><span class=mf>2.10</span><span class=o>.</span><span class=mi>0</span><span class=o>-</span><span class=n>clean</span><span class=o>/</span><span class=n>util</span><span class=o>/</span><span class=n>memfd</span><span class=o>.</span><span class=n>c</span>      <span class=mi>2018</span><span class=o>-</span><span class=mi>11</span><span class=o>-</span><span class=mi>20</span> <span class=mi>18</span><span class=p>:</span><span class=mi>11</span><span class=p>:</span><span class=mf>00.170271506</span> <span class=o>+</span><span class=mi>0100</span>
</span></span><span class=line><span class=cl><span class=o>+++</span> <span class=n>qemu</span><span class=o>-</span><span class=mf>2.10</span><span class=o>.</span><span class=mi>0</span><span class=o>/</span><span class=n>util</span><span class=o>/</span><span class=n>memfd</span><span class=o>.</span><span class=n>c</span>    <span class=mi>2018</span><span class=o>-</span><span class=mi>11</span><span class=o>-</span><span class=mi>20</span> <span class=mi>18</span><span class=p>:</span><span class=mi>11</span><span class=p>:</span><span class=mf>13.398423613</span> <span class=o>+</span><span class=mi>0100</span>
</span></span><span class=line><span class=cl><span class=err>@@</span> <span class=o>-</span><span class=mi>37</span><span class=p>,</span><span class=mi>7</span> <span class=o>+</span><span class=mi>37</span><span class=p>,</span><span class=mi>7</span> <span class=err>@@</span>
</span></span><span class=line><span class=cl> <span class=c1>#include &lt;sys/syscall.h&gt;</span>
</span></span><span class=line><span class=cl> <span class=c1>#include &lt;asm/unistd.h&gt;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=o>-</span><span class=k>static</span> <span class=ne>int</span> <span class=n>memfd_create</span><span class=p>(</span><span class=k>const</span> <span class=n>char</span> <span class=o>*</span><span class=n>name</span><span class=p>,</span> <span class=n>unsigned</span> <span class=ne>int</span> <span class=n>flags</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=o>+</span><span class=ne>int</span> <span class=n>memfd_create</span><span class=p>(</span><span class=k>const</span> <span class=n>char</span> <span class=o>*</span><span class=n>name</span><span class=p>,</span> <span class=n>unsigned</span> <span class=ne>int</span> <span class=n>flags</span><span class=p>)</span>
</span></span><span class=line><span class=cl> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=c1>#ifdef __NR_memfd_create</span>
</span></span><span class=line><span class=cl>     <span class=k>return</span> <span class=n>syscall</span><span class=p>(</span><span class=n>__NR_memfd_create</span><span class=p>,</span> <span class=n>name</span><span class=p>,</span> <span class=n>flags</span><span class=p>);</span></span></span></code></pre></td></tr></table></div></div><p><figure><a class=lightgallery href="https://cdn.haoyep.com/gh/leegical/Blog_img/md_img202312132253824.png?size=large" data-thumbnail="https://cdn.haoyep.com/gh/leegical/Blog_img/md_img202312132253824.png?size=small" data-sub-html="<h2> </h2><p>新增memfd_create.diff文件</p>"><img loading=lazy src=https://cdn.haoyep.com/gh/leegical/Blog_img/md_img202312132253824.png alt=新增memfd_create.diff文件 srcset="https://cdn.haoyep.com/gh/leegical/Blog_img/md_img202312132253824.png?size=small, https://cdn.haoyep.com/gh/leegical/Blog_img/md_img202312132253824.png?size=medium 1.5x, https://cdn.haoyep.com/gh/leegical/Blog_img/md_img202312132253824.png?size=large 2x" data-title=新增memfd_create.diff文件 style="background:url(/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>新增memfd_create.diff文件</figcaption></figure></p><h4 id=修改脚本 class=heading-element><span>3.1.3 修改脚本</span>
<a href=#%e4%bf%ae%e6%94%b9%e8%84%9a%e6%9c%ac class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>修改<code>build_qemu_support.sh</code>文件</p><ol><li>修改<code>QEMU_URL</code>为<code>QEMU_URL="https://download.qemu.org/qemu-${VERSION}.tar.xz"</code><figure><a class=lightgallery href="https://cdn.haoyep.com/gh/leegical/Blog_img/md_img202312132254858.png?size=large" data-thumbnail="https://cdn.haoyep.com/gh/leegical/Blog_img/md_img202312132254858.png?size=small" data-sub-html="<h2> </h2><p>修改QEMU_URL</p>"><img loading=lazy src=https://cdn.haoyep.com/gh/leegical/Blog_img/md_img202312132254858.png alt=修改QEMU_URL srcset="https://cdn.haoyep.com/gh/leegical/Blog_img/md_img202312132254858.png?size=small, https://cdn.haoyep.com/gh/leegical/Blog_img/md_img202312132254858.png?size=medium 1.5x, https://cdn.haoyep.com/gh/leegical/Blog_img/md_img202312132254858.png?size=large 2x" data-title=修改QEMU_URL style="background:url(/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>修改QEMU_URL</figcaption></figure></li><li>在<code>patch -p1 &lt;../patches/syscall.diff || exit 1</code>的下一行添加<code>patch -p1 &lt;../patches/memfd_create.diff || exit 1</code><figure><a class=lightgallery href="https://cdn.haoyep.com/gh/leegical/Blog_img/md_img202312132255894.png?size=large" data-thumbnail="https://cdn.haoyep.com/gh/leegical/Blog_img/md_img202312132255894.png?size=small" data-sub-html="<h2> </h2><p>添加memfd_create.diff patch命令</p>"><img loading=lazy src=https://cdn.haoyep.com/gh/leegical/Blog_img/md_img202312132255894.png alt="添加memfd_create.diff patch命令" srcset="https://cdn.haoyep.com/gh/leegical/Blog_img/md_img202312132255894.png?size=small, https://cdn.haoyep.com/gh/leegical/Blog_img/md_img202312132255894.png?size=medium 1.5x, https://cdn.haoyep.com/gh/leegical/Blog_img/md_img202312132255894.png?size=large 2x" data-title="添加memfd_create.diff patch命令" style="background:url(/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>添加memfd_create.diff patch命令</figcaption></figure></li></ol><h4 id=编译及安装 class=heading-element><span>3.1.4 编译及安装</span>
<a href=#%e7%bc%96%e8%af%91%e5%8f%8a%e5%ae%89%e8%a3%85 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>在 afl 的根目录打开终端执行以下命令：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>cd qemu_mode
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>./build_qemu_support.sh
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>cd ..
</span></span><span class=line><span class=cl>sudo make install</span></span></code></pre></td></tr></table></div></div><p><figure><a class=lightgallery href="https://cdn.haoyep.com/gh/leegical/Blog_img/md_img202312132316017.png?size=large" data-thumbnail="https://cdn.haoyep.com/gh/leegical/Blog_img/md_img202312132316017.png?size=small" data-sub-html="<h2> </h2><p>afl编译成功示例</p>"><img loading=lazy src=https://cdn.haoyep.com/gh/leegical/Blog_img/md_img202312132316017.png alt=afl编译成功示例 srcset="https://cdn.haoyep.com/gh/leegical/Blog_img/md_img202312132316017.png?size=small, https://cdn.haoyep.com/gh/leegical/Blog_img/md_img202312132316017.png?size=medium 1.5x, https://cdn.haoyep.com/gh/leegical/Blog_img/md_img202312132316017.png?size=large 2x" data-title=afl编译成功示例 style="background:url(/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>afl编译成功示例</figcaption></figure></p><h3 id=运行-qemu-mode class=heading-element><span>3.2 运行 qemu mode</span>
<a href=#%e8%bf%90%e8%a1%8c-qemu-mode class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>假设存在文件目录结构如下。其中<code>in</code>文件夹中的<code>a.in</code>文件是输入的初始种子，手动输入一个命令行参数进去即可。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./qemu-test/
</span></span><span class=line><span class=cl>├── benchmark /* 要测试的程序二进制文件 */
</span></span><span class=line><span class=cl>├── in        /* 输入文件夹，存储用户自定义的输入种子 */
</span></span><span class=line><span class=cl>│   └── a.in
</span></span><span class=line><span class=cl>└── out       /* 输出文件夹，存储AFL探索到的测试用例 */</span></span></code></pre></td></tr></table></div></div><p>则使用以下命令运行 AFL qemu mode。稍等片刻，就可以看到 AFL 运行界面。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>afl-fuzz -i in/ -o out/ -Q ./benchmark</span></span></code></pre></td></tr></table></div></div><p><figure><a class=lightgallery href="https://cdn.haoyep.com/gh/leegical/Blog_img/cdnimg/run-afl-qemu-mode.png?size=large" data-thumbnail="https://cdn.haoyep.com/gh/leegical/Blog_img/cdnimg/run-afl-qemu-mode.png?size=small" data-sub-html="<h2> </h2><p>运行 qemu mode</p>"><img loading=lazy src=https://cdn.haoyep.com/gh/leegical/Blog_img/cdnimg/run-afl-qemu-mode.png alt="运行 qemu mode" srcset="https://cdn.haoyep.com/gh/leegical/Blog_img/cdnimg/run-afl-qemu-mode.png?size=small, https://cdn.haoyep.com/gh/leegical/Blog_img/cdnimg/run-afl-qemu-mode.png?size=medium 1.5x, https://cdn.haoyep.com/gh/leegical/Blog_img/cdnimg/run-afl-qemu-mode.png?size=large 2x" data-title="运行 qemu mode" style="background:url(/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>运行 qemu mode</figcaption></figure></p><h4 id=停止运行 class=heading-element><span>3.2.1 停止运行</span>
<a href=#%e5%81%9c%e6%ad%a2%e8%bf%90%e8%a1%8c class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>当<code>cycles done</code>的数字变成绿色，说明 AFL 已找不到更有价值的路径。此时，就可以按下<code>Ctrl+C</code>终止 AFL 运行。<figure><a class=lightgallery href="https://cdn.haoyep.com/gh/leegical/Blog_img/cdnimg/202312221256348.png?size=large" data-thumbnail="https://cdn.haoyep.com/gh/leegical/Blog_img/cdnimg/202312221256348.png?size=small" data-sub-html="<h2> </h2><p>绿色，可以停止运行AFL</p>"><img loading=lazy src=https://cdn.haoyep.com/gh/leegical/Blog_img/cdnimg/202312221256348.png alt=绿色，可以停止运行AFL srcset="https://cdn.haoyep.com/gh/leegical/Blog_img/cdnimg/202312221256348.png?size=small, https://cdn.haoyep.com/gh/leegical/Blog_img/cdnimg/202312221256348.png?size=medium 1.5x, https://cdn.haoyep.com/gh/leegical/Blog_img/cdnimg/202312221256348.png?size=large 2x" data-title=绿色，可以停止运行AFL style="background:url(/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>绿色，可以停止运行AFL</figcaption></figure></p><h2 id=失败报错解决方案 class=heading-element><span>4 失败报错解决方案</span>
<a href=#%e5%a4%b1%e8%b4%a5%e6%8a%a5%e9%94%99%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><h3 id=core_pattern class=heading-element><span>4.1 core_pattern</span>
<a href=#core_pattern class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p><figure><a class=lightgallery href="https://cdn.haoyep.com/gh/leegical/Blog_img/cdnimg/202312141514236.png?size=large" data-thumbnail="https://cdn.haoyep.com/gh/leegical/Blog_img/cdnimg/202312141514236.png?size=small" data-sub-html="<h2> </h2><p>core_pattern错误</p>"><img loading=lazy src=https://cdn.haoyep.com/gh/leegical/Blog_img/cdnimg/202312141514236.png alt=core_pattern错误 srcset="https://cdn.haoyep.com/gh/leegical/Blog_img/cdnimg/202312141514236.png?size=small, https://cdn.haoyep.com/gh/leegical/Blog_img/cdnimg/202312141514236.png?size=medium 1.5x, https://cdn.haoyep.com/gh/leegical/Blog_img/cdnimg/202312141514236.png?size=large 2x" data-title=core_pattern错误 style="background:url(/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>core_pattern错误</figcaption></figure></p><p>参考 <a href=https://stackoverflow.com/questions/35441062/afl-fuzzing-without-root-avoid-modifying-proc-sys-kernel-core-pattern target=_blank rel="external nofollow noopener noreferrer">AFL fuzzing without root - avoid modifying /proc/sys/kernel/core_pattern<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a>，这是因为 AFL 希望系统将 coredump 输出到文件，而不是上报给系统的处理程序。报错信息如下：<div class="details admonition failure open"><div class="details-summary admonition-title"><i class="icon fa-fw fa-solid fa-xmark" aria-hidden=true></i>core dump报错<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content><p>[-] Hmm, your system is configured to send core dump notifications to an
external utility. This will cause issues: there will be an extended delay
between stumbling upon a crash and having this information relayed to the
fuzzer via the standard waitpid() API.</p><pre><code>To avoid having crashes misinterpreted as timeouts, please log in as root
and temporarily modify /proc/sys/kernel/core_pattern, like so:

echo core &gt;/proc/sys/kernel/core_pattern
</code></pre><p>[-] PROGRAM ABORT : Pipe at the beginning of &lsquo;core_pattern&rsquo;
Location : check_crash_handling(), afl-fuzz.c:7314</p></div></div></div></p><p>解决方法有两种：</p><ol><li>添加环境变量，参考 <a href="https://groups.google.com/g/afl-users/c/7arn66RyNfg/m/BsnOPViuCAAJ?pli=1" target=_blank rel="external nofollow noopener noreferrer">Disabling the /proc/sys/kernel/core_pattern check<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a></li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>export</span> <span class=nv>AFL_I_DONT_CARE_ABOUT_MISSING_CRASHES</span><span class=o>=</span><span class=m>1</span></span></span></code></pre></td></tr></table></div></div><div class="alert alert-note"><p class=alert-title><svg class="icon" viewBox="0 0 16 16" width="16" height="16"><path d="M0 8a8 8 0 1116 0A8 8 0 010 8zm8-6.5a6.5 6.5.0 100 13 6.5 6.5.0 000-13zM6.5 7.75A.75.75.0 017.25 7h1a.75.75.0 01.75.75v2.75h.25a.75.75.0 010 1.5h-2a.75.75.0 010-1.5h.25v-2h-.25a.75.75.0 01-.75-.75zM8 6a1 1 0 110-2 1 1 0 010 2z"/></svg>注意</p><p>按照之前 <a href=https://stackoverflow.com/questions/35441062/afl-fuzzing-without-root-avoid-modifying-proc-sys-kernel-core-pattern target=_blank rel="external nofollow noopener noreferrer">stackoverflow问题<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a>中的评论，这个环境变量只是抑制了有关它的警告？使用此标志，AFL 将运行并且不会显示警告消息，并<a href=https://github.com/google/fuzzer-test-suite/issues/60 target=_blank rel="external nofollow noopener noreferrer">可能错过崩溃<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a>。</p></div><ol start=2><li>按照 AFL 提示修改文件</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo su
</span></span><span class=line><span class=cl><span class=nb>echo</span> core &gt;/proc/sys/kernel/core_pattern</span></span></code></pre></td></tr></table></div></div><h3 id=cpu-frequency class=heading-element><span>4.2 CPU frequency</span>
<a href=#cpu-frequency class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p><figure><a class=lightgallery href="https://cdn.haoyep.com/gh/leegical/Blog_img/cdnimg/202312141515270.png?size=large" data-thumbnail="https://cdn.haoyep.com/gh/leegical/Blog_img/cdnimg/202312141515270.png?size=small" data-sub-html="<h2> </h2><p>CPU frequency错误</p>"><img loading=lazy src=https://cdn.haoyep.com/gh/leegical/Blog_img/cdnimg/202312141515270.png alt="CPU frequency错误" srcset="https://cdn.haoyep.com/gh/leegical/Blog_img/cdnimg/202312141515270.png?size=small, https://cdn.haoyep.com/gh/leegical/Blog_img/cdnimg/202312141515270.png?size=medium 1.5x, https://cdn.haoyep.com/gh/leegical/Blog_img/cdnimg/202312141515270.png?size=large 2x" data-title="CPU frequency错误" style="background:url(/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>CPU frequency错误</figcaption></figure>报错信息如下：<div class="details admonition failure open"><div class="details-summary admonition-title"><i class="icon fa-fw fa-solid fa-xmark" aria-hidden=true></i>core dump报错<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content><p>[-] Whoops, your system uses on-demand CPU frequency scaling, adjusted
between 781 and 1660 MHz. Unfortunately, the scaling algorithm in the
kernel is imperfect and can miss the short-lived processes spawned by
afl-fuzz. To keep things moving, run these commands as root:</p><pre><code>cd /sys/devices/system/cpu
echo performance | tee cpu*/cpufreq/scaling_governor

You can later go back to the original state by replacing 'performance' with
'ondemand'. If you don't want to change the settings, set AFL_SKIP_CPUFREQ
to make afl-fuzz skip this check - but expect some performance drop.
</code></pre><p>[-] PROGRAM ABORT : Suboptimal CPU scaling governor
Location : check_cpu_governor(), afl-fuzz.c:7376</p></div></div></div>这是 CPU 频率未固定的错误提示，参考<a href=http://www.cse.psu.edu/~gxt29/teaching/cs447s19/slides/06testingFuzzing.pdf target=_blank rel="external nofollow noopener noreferrer">这里<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a>，解决方案是引入环境变量：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>export</span> <span class=nv>AFL_SKIP_CPUFREQ</span><span class=o>=</span><span class=m>1</span></span></span></code></pre></td></tr></table></div></div></div><hr class=awesome-hr><h2 id=see-also>相关内容</h2><ul><li><a href=/posts/ubuntu22-install-clang10/ title="Ubuntu 22.04 LTS 64位系统安装 Clang10 版本">Ubuntu 22.04 LTS 64位系统安装 Clang10 版本</a></li><li><a href=/posts/digfuzz/ title=Digfuzz工具论文调研>Digfuzz工具论文调研</a></li><li><a href=/posts/ptatm-1/ title=PTATM（一）：初始化工作>PTATM（一）：初始化工作</a></li><li><a href=/posts/zsh-config-oh-my-zsh/ title="Zsh 安装与配置，使用 Oh-My-Zsh 美化终端">Zsh 安装与配置，使用 Oh-My-Zsh 美化终端</a></li><li><a href=/posts/optimize-github-pages-blog-access-speed/ title="Github Pages 博客网站访问速度优化">Github Pages 博客网站访问速度优化</a></li></ul><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span title="更新于 2024-11-03 00:53:39">更新于 2024-11-03&nbsp;</span></div><div class=post-info-license><span><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div><div class=post-info-line><div class=post-info-md><span><a href=/posts/afl-install/index.md title=阅读原始文档 class=link-to-markdown>阅读原始文档</a></span><span><a href="https://github.com/leegical/blog/blob/main/content/posts/%e7%a7%91%e7%a0%94/afl-install.md?plain=1" title=查看源码 target=_blank rel="external nofollow noopener noreferrer" class=link-to-source>查看源码</a></span><span><a href=https://github.com/leegical/blog/edit/main/content/posts/%e7%a7%91%e7%a0%94/afl-install.md title=编辑此页 target=_blank rel="external nofollow noopener noreferrer" class=link-to-edit>编辑此页</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 X" data-sharer=twitter data-url=https://www.haoyep.com/posts/afl-install/ data-title="Ubuntu 22.04 安装 AFL 及 Qemu Mode 实践" data-hashtags=Ubuntu,Linux,AFL,模糊测试><i class="fa-brands fa-x-twitter fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://www.haoyep.com/posts/afl-install/ data-hashtag=Ubuntu><i class="fa-brands fa-facebook-square fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 Linkedin" data-sharer=linkedin data-url=https://www.haoyep.com/posts/afl-install/><i class="fa-brands fa-linkedin fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://www.haoyep.com/posts/afl-install/ data-title="Ubuntu 22.04 安装 AFL 及 Qemu Mode 实践" data-image=https://cdn.haoyep.com/gh/leegical/Blog_img/cdnimg/202401171443369.png><i class="fa-brands fa-weibo fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 百度" data-sharer=baidu data-url=https://www.haoyep.com/posts/afl-install/ data-title="Ubuntu 22.04 安装 AFL 及 Qemu Mode 实践"><i data-svg-src=https://unpkg.com/simple-icons@9.19.0/icons/baidu.svg aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 Skype" data-sharer=skype data-url=https://www.haoyep.com/posts/afl-install/ data-title="Ubuntu 22.04 安装 AFL 及 Qemu Mode 实践"><i class="fa-brands fa-skype fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fa-solid fa-tags fa-fw me-1" aria-hidden=true></i><a href=/tags/ubuntu/ class=post-tag title="标签 - Ubuntu">Ubuntu</a><a href=/tags/linux/ class=post-tag title="标签 - Linux">Linux</a><a href=/tags/afl/ class=post-tag title="标签 - AFL">AFL</a><a href=/tags/%E6%A8%A1%E7%B3%8A%E6%B5%8B%E8%AF%95/ class=post-tag title="标签 - 模糊测试">模糊测试</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/posts/optimize-github-pages-blog-access-speed/ class=post-nav-item rel=prev title="Github Pages 博客网站访问速度优化"><i class="fa-solid fa-angle-left fa-fw" aria-hidden=true></i>Github Pages 博客网站访问速度优化</a><a href=/posts/zsh-config-oh-my-zsh/ class=post-nav-item rel=next title="Zsh 安装与配置，使用 Oh-My-Zsh 美化终端">Zsh 安装与配置，使用 Oh-My-Zsh 美化终端<i class="fa-solid fa-angle-right fa-fw" aria-hidden=true></i></a></div></div><div id=comments><div id=giscus class=comment><script src=https://giscus.app/client.js data-repo=leegical/leegical.github.io data-repo-id=R_kgDOKqVEVg data-category=Announcements data-category-id=DIC_kwDOKqVEVs4Cax6P data-mapping=pathname data-strict=0 data-theme=preferred_color_scheme data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-lang=zh-CN data-loading=lazy crossorigin=anonymous async defer></script></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://giscus.app/ rel="external nofollow noopener noreferrer">giscus</a>.</noscript></div></article><aside class=toc id=toc-auto aria-label=目录><h2 class=toc-title>目录&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden=true></i></h2><div class=toc-content id=toc-content-auto></div></aside></main><footer class=footer><div class=footer-container><div class="footer-line copyright" itemscope itemtype=http://schema.org/CreativeWork><i class="fa-regular fa-copyright fa-fw" aria-hidden=true></i>
<span itemprop=copyrightYear>2019 - 2024</span><span class=author itemprop=copyrightHolder>
<a href=https://www.haoyep.com/ target=_blank rel="external nofollow noopener noreferrer">Leehow</a></span><span class="license footer-divider"><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div><div class="footer-line statistics"><span class=site-time title=网站运行中……><i class="fa-solid fa-heartbeat fa-fw animate-icon" aria-hidden=true></i><span class="ms-1 d-none">博客已运行</span><span class="run-times ms-1">网站运行中……</span></span></div><div class="footer-line visitor order-1"><span id=busuanzi_container_site_uv title=总访客数><i class="fa-regular fa-user fa-fw me-1" aria-hidden=true></i><span id=busuanzi_value_site_uv><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden=true></i></span></span><span id=busuanzi_container_site_pv class=footer-divider title=总访问量><i class="fa-regular fa-eye fa-fw me-1" aria-hidden=true></i><span id=busuanzi_value_site_pv><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden=true></i></span></span></div><div class="footer-line beian order-2"><span class="icp footer-divider"><a href='https://icp.gov.moe/?keyword=20239399' target=_blank>萌ICP备20239399号</a></span></div></div></footer></div><div class=widgets><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role=button aria-label=回到顶部><i class="fa-solid fa-arrow-up fa-fw" aria-hidden=true></i><span class=variant-numeric>0%</span></div><div class="fixed-button view-comments d-none" role=button aria-label=查看评论><i class="fa-solid fa-comment fa-fw" aria-hidden=true></i></div></div><div id=mask></div><div class=reading-progress-bar style=left:0;top:0;--bg-progress:#8581dd;--bg-progress-dark:#fff></div><noscript><div class=noscript-warning>该网站在启用 JavaScript 的情况下效果最佳。</div></noscript></div><link rel=stylesheet href=https://unpkg.com/lightgallery@2.7.2/css/lightgallery-bundle.min.css><link rel=preload href=https://unpkg.com/katex@0.16.10/dist/katex.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://unpkg.com/katex@0.16.10/dist/katex.min.css></noscript><link rel=stylesheet href=https://unpkg.com/pace-js@1.2.4/themes/orange/pace-theme-minimal.css><script src=https://unpkg.com/autocomplete.js@0.38.1/dist/autocomplete.min.js defer></script><script src=https://unpkg.com/algoliasearch@4.20.0/dist/algoliasearch-lite.umd.js defer></script><script src=https://unpkg.com/instant.page@5.2.0/instantpage.js async defer type=module></script><script src=https://unpkg.com/lightgallery@2.7.2/lightgallery.min.js defer></script><script src=https://unpkg.com/lightgallery@2.7.2/plugins/thumbnail/lg-thumbnail.min.js defer></script><script src=https://unpkg.com/lightgallery@2.7.2/plugins/zoom/lg-zoom.min.js defer></script><script src=https://unpkg.com/sharer.js@0.5.1/sharer.min.js async defer></script><script src=https://unpkg.com/katex@0.16.10/dist/katex.min.js defer></script><script src=https://unpkg.com/katex@0.16.10/dist/contrib/auto-render.min.js defer></script><script src=https://unpkg.com/katex@0.16.10/dist/contrib/copy-tex.min.js defer></script><script src=https://unpkg.com/katex@0.16.10/dist/contrib/mhchem.min.js defer></script><script src=https://vercount.one/js async defer></script><script src=https://unpkg.com/pace-js@1.2.4/pace.min.js async defer></script><script>window.config={autoBookmark:!0,code:{copyTitle:"复制到剪贴板",editLockTitle:"锁定可编辑代码块",editUnLockTitle:"解锁可编辑代码块",editable:!0,maxShownLines:15},comment:{enable:!0,expired:!1,giscus:{darkTheme:"dark_dimmed",lightTheme:"light",origin:"https://giscus.app"}},enablePWA:!0,lightgallery:!0,math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{algoliaAppID:"23TF0E394I",algoliaIndex:"index",algoliaSearchKey:"748e3a3e3ef2f537198c57b19d5ff3e6",highlightTag:"em",maxResultLength:10,noResultsFound:"没有找到结果",snippetLength:50,type:"algolia"},siteTime:"2018-02-06T11:15:22+08:00",version:"v0.3.13"}</script><script src=/js/theme.min.js defer></script><script src=/js/custom.min.js defer></script></body></html>